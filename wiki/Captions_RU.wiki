#summary О способе интернационализации, используемом в nocturne

= Captions =

Nocturne позволяет очень просто писать многоязыковые приложения и легко править различные подписи, надписи и проч.

Механизм называется Captions и суть его состоит в том, что вывод любой текстовой информации оборачивается в caption. Например, в шаблоне вместо 
{{{
<td>Login:</td><td><input name="login" class="login"/></td>
}}}
должно быть написано
{{{
<td>{{Login}}:</td><td><input name="login" class="login"/></td>
}}}
Одним из плюсов этого подхода является то, что шаблоны остаются простыми для чтения и не 
перегружены константами типа {{{messages.password-change-confirmation-label}}}.

В таком случае на этапе загрузки темплейта Nocturne обработает инструкцию {{{ {{Login}} }}} и заменит ее на значение caption-а с именем {{{Login}}} в нужной локали. 

Все что выводится и может быть зависимо от языка должно проходить через caption-ы. Например, иногда это надо делать и в коде приложения. Сообщения от валидаторов должны быть обернуты, а они зачастую берутся из {{{ValidationException}}}: 
{{{
        if (!value.matches("\\w+")) {
            throw new ValidationException($("Field should contain letters, digits and underscore characters"));
        }
}}}

Обратите внимание на волшебный метод {{{$()}}}, который есть у всех валидаторов, контроллеров и доступен из любого участка кода через {{{ApplicationContext.getInstance().$}}}. У него есть форма, которая позволяет передать параметры в виде, например
{{{
$("Field should contain at least {0} characters", minimalLength)
}}}

В темплейтах кроме синтаксиса с двойными фигурными скобками можно использовать директиву caption, примеры:
{{{
     <@caption params=["Mike"]>Hello, {0}</@caption>
     <@caption>Login</@caption>
     <@caption key="Login"/>
     <@caption key="Hello, {0}" params=["Mike"]/>
}}}

Механизм caption-ов может быть полезен и для одноязыкового приложения, так как программист
может не задумываться о точных надписях или грамматической корректности, в то время как 
специалист может исправить или переписать caption-ы, редактируя их (или переводя) через web-интерфейс.

= interface Captions =
Все обращения к captions проходят через реализацию интерфейса {{{org.nocturne.caption.Captions}}}, специфичную для вашего приложения. Простейшая реализация называется {{{org.nocturne.caption.CaptionsImpl}}} и является значением по умолчанию. Она хранит captions в properties-файликах в зависимости от локали (например, captions_ru.properties). Кроме того, анализируя значение nocturne.debug-captions-dir в debug mode эти файлы автоматически создаются и поддерживаются в соответствующей директории. Если значение отсутствует для локали, то в случае, если она дефолтная, устанавливается значение, совпадающее и именем caption-а. Иначе, устанавливается значение {{{nocturne.null}}}, обозначающее, что значение надо брать из локали по умолчанию.